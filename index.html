<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Servalink Dark/Light Mode</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary: #007AFF;
      --text: #FFFFFF;
      --bg: #1B1D2A;
      --card-bg: #1C1C1E;
      --border-color: rgba(255, 255, 255, 0.1);
    }

    body {
      font-family: "Inter", sans-serif;
      background-color: var(--bg);
      color: var(--text);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .section {
      margin-bottom: 24px;
      background-color: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .section-header {
      padding: 18px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .section-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
      background-color: var(--card-bg);
    }

    .section.active .section-content {
      max-height: 2000px; /* Adjust based on content */
      padding: 20px;
    }

    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 5px;
    }

    .tool-card {
      background-color: rgba(0, 0, 0, 0.1);
      padding: 20px;
      border-radius: 12px;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
    }

    .tool-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      background-color: var(--primary);
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .tool-link:hover {
      background-color: transparent;
      color: var(--primary);
      border-color: var(--primary);
    }

    .search-results {
      position: absolute;
      background-color: #1A1C29; /* Black container */
      color: white; /* White text */
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 10;
      width: calc(100% - 2rem);
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .search-result-item {
      padding: 10px;
      cursor: pointer;
    }

    .search-result-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="bg-[#1B1D2A] text-white transition-colors duration-300" id="body" data-theme="dark">

  <div class="min-h-screen flex flex-col md:flex-row overflow-hidden">
    <aside id="sidebar" class="bg-[#1A1C29] w-full md:w-52 flex-shrink-0 flex flex-row md:flex-col text-gray-400 text-sm select-none transition-colors duration-300">
      <div class="flex items-center justify-center md:justify-start gap-2 px-4 py-3 border-b border-[#2A2C3B] w-full" onclick="window.location.reload()">
        <img src="https://storage.googleapis.com/a1aa/image/6025c999-883f-4111-389e-e9385d06c3a8.jpg" alt="Servalink logo" class="w-12 h-12 rounded" />
        <span class="hidden md:inline text-white font-semibold">Servalink</span>
      </div>
      <nav class="flex md:flex-col gap-3 px-3 py-4 overflow-auto w-full justify-around">
        <button class="flex items-center gap-3 hover:text-white text-xs text-sm" onclick="window.location.reload()">
          <i class="fas fa-home"></i>
          <span class="hidden md:inline">Home</span>
        </button>
        <button class="flex items-center gap-3 hover:text-white text-xs text-sm" onclick="toggleChatbox()">
          <i class="fas fa-comments"></i><span class="hidden md:inline">Chatbox</span>
        </button>
        <button id="theme-toggle" class="flex items-center gap-3 text-xs text-sm cursor-pointer hover:text-white transition-colors duration-200" title="Toggle Dark/Light Mode">
          <i id="theme-icon" class="fas fa-moon"></i>
          <span class="hidden md:inline">Dark/Light</span>
        </button>
        <button class="flex items-center gap-3 hover:text-white text-xs text-sm" onclick="window.location.href='login.html'">
          <i class="fas fa-user-shield"></i>
          <span class="hidden md:inline">Login</span>
        </button>
      </nav>
    </aside>

    <main class="flex-1 p-4 md:p-6 flex flex-col gap-6 overflow-auto" id="container">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <h1 class="text-white font-semibold text-2xl select-none">Welcome to Servalink</h1>
        <div class="relative w-full md:max-w-md">
          <input type="search" id="searchInput" placeholder="Search tools..."
            class="w-full rounded-md bg-[#2A2C3B] text-gray-300 placeholder-gray-500 py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF3B30] transition-colors duration-300" />
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm pointer-events-none"></i>
          <div id="searchResults" class="search-results"></div>
        </div>
      </div>
      
      <div class="flex justify-between">
        <div class="live-time text-sm"></div>
        <div class="live-date text-sm"></div>
      </div>

      <div class="container" id="sectionsContainer">
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>Loading tools...</div>
        </div>
      </div>
    </main>
  </div>

  <div id="chatbox" class="fixed bottom-24 right-6 w-80 bg-white rounded-lg shadow-xl overflow-hidden hidden flex flex-col border border-gray-200 z-40" style="height: 450px;">
    <div class="bg-blue-600 text-white p-3 flex justify-between items-center">
      <span class="font-semibold">Servalink Support</span>
      <button id="closeChat" class="text-white hover:text-gray-200 text-xl focus:outline-none">&times;</button>
    </div>
    <div id="chatMessages" class="flex-1 p-4 overflow-y-auto bg-gray-50 chat-messages">
      <div class="mb-4 fade-in">
        <p class="bg-blue-100 text-gray-800 rounded-lg p-3 max-w-xs">Hello! How can I help you today?</p>
        <p class="text-xs text-gray-500 mt-1">Just now</p>
      </div>
    </div>
    <div class="p-3 border-t border-gray-200 bg-white flex">
      <input id="chatInput" type="text" placeholder="Type your message..." class="flex-1 border border-gray-300 rounded-l-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-800">
      <button id="sendButton" class="bg-blue-600 text-white px-4 rounded-r-lg hover:bg-blue-700 transition-colors">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAvouFf_LBHew8EhdnWm0i3fsTVXHTblCc",
      authDomain: "new1-f9abc.firebaseapp.com",
      projectId: "new1-f9abc",
      storageBucket: "new1-f9abc.appspot.com",
      messagingSenderId: "188713961246",
      appId: "1:188713961246:web:7cd412770c6c0256bc2b0f"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Load sections and tools
    function loadSectionsAndTools() {
      const container = document.getElementById("sectionsContainer");
      db.collection("sections").get().then(sectionSnap => {
        if (sectionSnap.empty) {
          container.innerHTML = '<div class="no-results">No sections available</div>';
          return;
        }
        container.innerHTML = '';
        sectionSnap.forEach(sectionDoc => {
          const section = sectionDoc.data();
          const sectionElement = document.createElement('div');
          sectionElement.className = 'section';
          sectionElement.innerHTML = `
            <div class="section-header" onclick="toggleSection('${sectionDoc.id}')">
              <h2 class="section-title">${section.name}</h2>
              <span class="toggle-icon">â–¼</span>
            </div>
            <div class="section-content" id="content-${sectionDoc.id}"></div>
          `;
          container.appendChild(sectionElement);
          loadToolsForSection(sectionDoc.id, section.name);
        });
      }).catch(error => {
        console.error("Error loading data:", error);
        container.innerHTML = '<div class="error-state">Failed to load data. Try again later.</div>';
      });
    }

    // Load tools for each section
    function loadToolsForSection(sectionId, sectionName) {
      const toolsContainer = document.getElementById(`content-${sectionId}`);
      db.collection("tools").where("section", "==", sectionName).get().then(toolSnap => {
        if (toolSnap.empty) {
          toolsContainer.innerHTML = '<div>No tools in this section</div>';
          return;
        }
        const toolsGrid = document.createElement('div');
        toolsGrid.className = 'tools-grid';
        toolSnap.forEach(toolDoc => {
          const tool = toolDoc.data();
          const toolCard = document.createElement('div');
          toolCard.className = 'tool-card';
          toolCard.innerHTML = `
            <div class="tool-name">${tool.name}</div>
            <a href="${tool.link}" target="_blank" class="tool-link">Open</a>
            
          `;
          toolsGrid.appendChild(toolCard);
        });
        toolsContainer.appendChild(toolsGrid);
      }).catch(error => {
        console.error(`Error loading tools for ${sectionName}:`, error);
        toolsContainer.innerHTML = '<div>Failed to load tools</div>';
      });
    }

    // Toggle section visibility
    function toggleSection(sectionId) {
      const content = document.getElementById(`content-${sectionId}`);
      content.classList.toggle('active');
      content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + "px";
    }

    // Add tool to favorites
    function addToFavorites(toolName) {
      const favoritesList = document.getElementById("favoritesList");
      const favoriteItem = document.createElement('div');
      favoriteItem.textContent = toolName;
      favoritesList.appendChild(favoriteItem);
    }

    // Theme toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const body = document.getElementById('body');

    themeToggle.addEventListener('click', () => {
      const isDark = body.getAttribute('data-theme') === 'dark';
      body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      themeIcon.classList.toggle('fa-moon', !isDark);
      themeIcon.classList.toggle('fa-sun', isDark);
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    });

    // Initialize theme from localStorage
    const savedTheme = localStorage.getItem('theme') || 'dark';
    body.setAttribute('data-theme', savedTheme);
    if (savedTheme === 'light') {
      themeIcon.classList.replace('fa-moon', 'fa-sun');
    }

    // Live time and date functionality
    function updateClock() {
      const now = new Date();
      document.querySelector(".live-time").textContent = now.toLocaleTimeString();
      document.querySelector(".live-date").textContent = now.toLocaleDateString(undefined, {
        weekday: "long", year: "numeric", month: "long", day: "numeric"
      });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');

    searchInput.addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      searchResults.innerHTML = ''; // Clear previous results

      if (searchTerm) {
        const toolCards = document.querySelectorAll('.tool-card');
        toolCards.forEach(card => {
          const name = card.querySelector('.tool-name').textContent.toLowerCase();
          if (name.includes(searchTerm)) {
            const resultItem = document.createElement('div');
            resultItem.className = 'search-result-item';
            resultItem.textContent = name;
            resultItem.onclick = () => {
              // Show the corresponding tool's container
              const sectionId = card.closest('.section').id;
              toggleSection(sectionId);
              searchInput.value = ''; // Clear the search input
              searchResults.style.display = 'none'; // Hide search results
            };
            searchResults.appendChild(resultItem);
          }
        });
        if (searchResults.children.length > 0) {
          searchResults.style.display = 'block';
        } else {
          searchResults.style.display = 'none';
        }
      } else {
        searchResults.style.display = 'none';
      }
    });

    // Chatbox functionality
    const chatToggle = document.getElementById('chatbox');
    const closeChat = document.getElementById('closeChat');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const chatMessages = document.getElementById('chatMessages');

    function toggleChatbox() {
      chatToggle.classList.toggle('hidden');
      if (!chatToggle.classList.contains('hidden')) {
        setTimeout(() => chatInput.focus(), 100);
      }
    }

    closeChat.addEventListener('click', toggleChatbox);

    function sendMessage() {
      const message = chatInput.value.trim();
      if (message) {
        addMessage(message, 'user');
        chatInput.value = '';
        
        // Simulate bot response
        setTimeout(() => {
          const responses = [
            "I understand. How can I assist you further?",
            "Thanks for your message. We'll respond soon.",
            "That's an interesting question. Let me check...",
            "I can help with that. What specific information do you need?",
            "We're here to help. Can you provide more details?"
          ];
          const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          addMessage(randomResponse, 'bot');
        }, 800);
      }
    }

    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `mb-4 fade-in ${sender === 'user' ? 'text-right' : 'text-left'}`;
      
      const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      messageDiv.innerHTML = `
        <p class="${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'} 
           rounded-lg p-3 inline-block max-w-xs">
          ${text}
        </p>
        <p class="text-xs text-gray-500 mt-1">${timestamp}</p>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    sendButton.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Load sections and tools on DOMContentLoaded
    document.addEventListener("DOMContentLoaded", loadSectionsAndTools);
  </script>
</body>
</html>

